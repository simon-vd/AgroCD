---
sidebarDepth: 1
---

# üî• MongoDB Tutorial

![MongoDB for Morons](2023-11-07-20-55-40.png =50%x)

## MongoDB Ahoy!

We will use the official MongoDB Docker image. The documentation on how to use the image can be found [here](https://hub.docker.com/_/mongo).

:::danger EXERCISE 1
Create a new directory `mongodb`. Use Docker Compose to run the MongoDB. Use the latest `mongo` image if you can.
- use username `admin` and password `admin123` for the root user
:::

:::warning WARNING
Should you get a ‚Äúcore dumped‚Äù error, then your CPU does not support [AVX](https://en.wikipedia.org/wiki/Advanced_Vector_Extensions) instructions. AVX is required for newer versions of MongoDB. In this case, you can use an older MongoDB 4.0 version as a workaround.
:::

## Connecting to MongoDB

MongoDB provides the `mongosh` CLI tool to connect to a MongoDB instance. You can find the documentation [here](https://docs.mongodb.com/mongodb-shell/).

The command to connect to a MongoDB instance is:

```bash
mongosh --host <mongodb_host> -u <username> -p <password>
```
We can now run a second, temporary container to connect to the MongoDB instance.

:::danger EXERCISE 2
Use a `docker run` command to run a separate container and connect to the MongoDB instance using the root user you created before. Use the `mongo` image.
The result:

```bash
Connecting to:		...
Using MongoDB:		7.0.2
Using Mongosh:		2.0.1

For mongosh info see: https://docs.mongodb.com/mongodb-shell/


To help improve our products, anonymous usage data is collected and sent to MongoDB periodically (https://www.mongodb.com/legal/privacy-policy).
You can opt-out by running the disableTelemetry() command.

------
   The server generated these startup warnings when booting
   2023-11-07T20:14:28.769+00:00: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine. See http://dochub.mongodb.org/core/prodnotes-filesystem
   2023-11-07T20:14:29.640+00:00: vm.max_map_count is too low
------

test> show dbs;
admin   100.00 KiB
config   60.00 KiB
local    72.00 KiB
test> db.runCommand({connectionStatus: 1})
{
  authInfo: {
    authenticatedUsers: [ { user: 'admin', db: 'admin' } ],
    authenticatedUserRoles: [ { role: 'root', db: 'admin' } ]
  },
  ok: 1
}
test> 
```
:::

## Adding a GUI

Mongo-express is a web-based MongoDB admin interface written with Node.js, Express.js, and Bootstrap3. It's like PHPMyAdmin, but for MongoDB and written in Node.js instead of PHP.
You can find the documentation [here](https://github.com/mongo-express/mongo-express).

:::danger EXERCISE 3
Add `mongo-express` to your `docker-compose.yaml` file:
- the credentials to access the Mongo-express interface should be `expressadm` and `expressadm123`. The credentials for the MongoDB instance should stay the same!
:::

![Mongo-express interface](2023-11-07-21-45-54.png =50%x)

:::danger EXERCISE 4
Take a look at the `system.users` collection in the `admin` database using mongo-express. You should see the `admin` user you created before.
:::

## Insert a collection in the database using `mongoimport`

We‚Äôre going to insert a new collection in the database `School`. You first need to create the database `School`.  This collection contains 50 documents. Each document contains random data.  

Each document has got the following fields:
- _id: gives you an unique id number
- index: gives you a counter
- isMarried: gives you the value true or false
- saldo: saldo bank account
- age: gives you an age between 20 and 40
- eyeColor: gives you a random color, you can choose blue, brown or green
- firstName: gives you a firstname
- company: gives you a company name
- email: gives you a fony mail address
- phone: gives you a phone number beginning with +32
- address: gives you a streetname followed by a number between 100 and 1000 followed by a number between 1000 and 9999 followed by a city  
- Each student or document has got 3 friends, these friend have an id and only a firstName 

You are not alone to do this task. In fact, you have an assistant for this task, the JSON generator! You can find him (or her) on [http://www.json-generator.com](http://www.json-generator.com/). Have fun with it!

:::danger EXERCISE 5
Put the generated records in your newly made collection `Students` using the `mongoimport` command. You can use `mongo` docker image to run the command. This is your first MongoDB collection ever. 

More info on mongoimport: [https://docs.mongodb.com/manual/reference/program/mongoimport/](https://docs.mongodb.com/manual/reference/program/mongoimport/)

The desired results after you have completed this mission:

```json
test> use School
switched to db School
School> db.Students.countDocuments()
50
School> db.Students.find()
[
  {
    _id: '654aa5c4a29e4d36e1365e7d',
    index: 0,
    guid: '262e4830-7e48-499c-8fd2-9bf92c56c77a',
    isMarried: false,
    saldo: '$1,444.34',
    age: 32,
    eyeColor: 'blue',
    firstName: 'Paulette',
    company: 'ACCUPHARM',
    email: 'paulettekent@accupharm.com',
    phone: '+32 (802) 453-2709',
    address: 'Stuyvesant Avenue 385, 1000, Shawmut',
    friends: [
      { id: 0, name: 'Gomez' },
      { id: 1, name: 'Burris' },
      { id: 2, name: 'Katherine' }
    ]
  },
  {
    _id: '654aa5c446a660929a2e23a7',
    index: 1,
    guid: '5b52b980-f203-454e-9b9b-802d7ef26393',
    isMarried: false,
    saldo: '$1,618.71',
    age: 35,
    eyeColor: 'green',
    firstName: 'Fleming',
    company: 'SATIANCE',
    email: 'flemingkent@satiance.com',
    phone: '+32 (925) 500-2516',
    address: 'Tompkins Avenue 557, 1000, Brewster',
    friends: [
      { id: 0, name: 'Butler' },
      { id: 1, name: 'Melanie' },
      { id: 2, name: 'Faulkner' }
    ]
  },
  ...

```
:::

## Challenging (but mandatory‚Ä¶

:::danger EXERCISE 6
Write a php script that reads certain data from the MongoDB database. 
For example: Show the firstname of all the students with blue eyes.

Some steps to take:
- Create a `Dockerfile` that builds and images that is based on the `php-apache` image, and has the [MongoDB PHP driver](https://www.php.net/manual/en/mongodb.installation.pecl.php) installed.
- Create an `index.php` that contains onlly `phpinfo();` to check if the MongoDB PHP driver is installed.
![phpinfo mongodb](2023-11-07-23-34-48.png =50%x)]
- Now, modify the `index.php` to connect to the MongoDB instance and query the database. 
- You should use `MongoDB\Driver\Manager` to connect to the database. You can find the documentation [here](https://www.php.net/manual/en/class.mongodb-driver-manager.php). 
- Use `MongoDB\Driver\Query` to define the filter. You can find the documentation [here](https://www.php.net/manual/en/class.mongodb-driver-query.php).

The result should look something like this:

![PHP Mongo result](2023-11-07-23-48-28.png =50%x)

And, when in doubt:

![Bing vs ChatGPT](2023-11-07-23-32-29.png =50%x)
:::

<!-- ## Full MEAN Stack Chat Application

Create a Dockerfile and set up a server for application. The application `chat-example` is a chat application written in Node.JS, and belongs to the ME(A)N stack family.

You can find the source code [on GitHub](https://github.com/socketio/chat-example).
Developers provide the following specs:

- Latest version of node.js required ([Docker Image](https://hub.docker.com/_/node)).
- Downloading can be done with `git clone https://github.com/socketio/chat-example.git`
- Install the dependencies with `npm install`.
- Starting the application with `npm start`
- Port is 3000 (you can change it with environment variable `PORT`)

Your assignment:

- Download the code
- Add a Dockerfile
- Build an image
- Run the image on port 8090, if this is running view the site on your laptop at http://IP Server:8090/ -->